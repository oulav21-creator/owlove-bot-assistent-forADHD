# Telegram-бот «Напарник» v2.0

Telegram-бот для личной эффективности, помогающий выстраивать дисциплину через короткие сессии фокуса, трекинг тренировок, изучение английского языка и аналитику. Создан специально для людей с СДВГ.

**Версия 2.0** включает полностью переработанный интерфейс с главным меню, управление задачами, трекинг тренировок, изучение неправильных глаголов и слов, аналитику и многое другое.

## Описание

Бот «Напарник» (hёlpik) — это спокойный помощник, который не давит, не стыдит и не использует мотивационные клише. Он работает короткими сессиями по 20 минут и помогает удерживать фокус без перегрузки. Минималистичный интерфейс с текстом и кнопками, без эмодзи.

## Возможности

### Главное меню

Бот использует ReplyKeyboard (кнопки внизу экрана) для главной навигации:

- **WORKOUT** — управление тренировками, анализ нагрузки, трекинг сна
- **SEARCH** — поиск видео на YouTube и статей в интернете
- **ENG** — изучение неправильных глаголов и слов с SRS
- **ANALYTICS** — аналитика продуктивности и статистика
- **FOCUS** — сессии фокуса, разгрузка головы

### WORKOUT (Тренировки)

- **Тренировки** — создание недельного плана тренировок, отслеживание выполнения
- **Анализ** — анализ нагрузки за 2 недели, рекомендации по корректировке
- **Сон** — трекинг сна с графиками за неделю, автоматические уведомления

### SEARCH (Поиск)

- Поиск видео на YouTube (длинные видео, русский язык, регион Россия)
- Поиск статей в интернете (Habr.com и другие источники)
- Возврат до 3-5 результатов с заголовками и ссылками

### ENG (Английский)

- **Неправильные глаголы** — изучение 200 самых используемых неправильных глаголов
  - Формат: 1 форма – 2 форма – 3 форма / Перевод / Примеры
  - Листание кнопками "Дальше" и "Назад"
  
- **Учить слова** — система изучения слов с SRS (Spaced Repetition System)
  - Добавление слов вручную (слово, объяснение, перевод)
  - Загрузка из CSV файла
  - Обучение по карточкам (слово → перевод)
  - Экспорт всех слов в CSV
  - Удаление слов (по одному или все сразу)
  - Пагинация при удалении слов

### ANALYTICS (Аналитика)

- **Продуктивность** — тепловая карта за 14 дней
  - Автоматическое обновление каждые 14 дней
  - Push-уведомление на 14-й день в 20:00
  
- **Статистика** — графики:
  - Сессии по дням
  - Средняя длительность
  - Процент завершённых сессий

### FOCUS (Фокус)

- **Сессия фокуса** — управление задачами и таймеры
  - Добавление задач (название, описание)
  - Начало сессии с выбором задачи
  - Редактирование задач
  - Удаление задач
  - Таймер с визуальным прогресс-баром
  - Пауза и отмена сессии
  
- **Разгрузка головы** — запись мыслей
  - Новая запись
  - Просмотр всех записей
  - Редактирование записей
  - Удаление записей
  
- **Delete stats** — удаление всей статистики
  - Подтверждение перед удалением
  - Удаление всех данных: сессии, сон, тренировки, разгрузки, задачи

## Требования

- Python 3.10 или выше (рекомендуется Python 3.12)
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))
- YouTube Data API Key (опционально, для функции поиска)

## Установка

1. Клонируйте репозиторий или скачайте файлы проекта

2. **Рекомендуется:** Создайте виртуальное окружение:
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:
   - Windows PowerShell: `venv\Scripts\Activate.ps1`
   - Windows CMD: `venv\Scripts\activate.bat`
   - Linux/Mac: `source venv/bin/activate`

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

**Примечание:** Если у вас возникают ошибки компиляции с pandas/numpy, используйте Python 3.12 или установите только бинарные пакеты (см. `install_binary_only.ps1`).

5. Создайте файл `.env` в корне проекта:
```
BOT_TOKEN=ваш_токен_бота
PORT=3000  # Опционально, используется только в режиме webhook
YOUTUBE_API_KEY=ваш_youtube_api_key  # Опционально, для функции поиска
TELEGRAM_USER_ID=ваш_telegram_user_id  # Для push-уведомлений

# Для локальной разработки ничего больше не нужно - бот автоматически использует polling
# Для деплоя добавьте одну из переменных ниже:
# WEBHOOK_URL=https://your-domain.com  # Для VPS или кастомного деплоя
# RENDER_EXTERNAL_URL=https://your-app.onrender.com  # Для Render
# SCALINGO_APP_URL=https://your-app.scalingo.io  # Для Scalingo
```

6. Запустите бота:
```bash
python bot.py
```

**Примечание:** 
- **Локально** бот автоматически использует polling (не требует webhook URL)
- **На сервере** установите `WEBHOOK_URL` или другую переменную URL для использования webhook режима

## Структура проекта

```
botFocus/
├── bot.py                 # Основной файл бота
├── database.py            # Работа с базой данных SQLite
├── timer.py               # Модуль таймера для сессий
├── irregular_verbs.py     # База неправильных глаголов
├── services/
│   ├── search.py          # Поиск на YouTube и в интернете
│   └── analytics.py       # Генерация графиков и аналитики
├── images/                # Изображения для меню
│   ├── workout.jpg
│   ├── search.jpeg
│   ├── eng.jpg
│   ├── anal.jpg
│   └── focus.jpg
├── requirements.txt       # Зависимости проекта
├── README.md             # Документация
├── .env                  # Токен бота (создать самостоятельно)
└── naparnik.db           # База данных SQLite (создается автоматически)
```

## Использование

После запуска бота отправьте команду `/start` в Telegram. Бот покажет приветственное сообщение и главное меню с кнопками: WORKOUT, SEARCH, ENG, ANALYTICS, FOCUS.

### Навигация

- **ReplyKeyboard** (кнопки внизу) — главное меню, всегда доступно
- **InlineKeyboard** (кнопки под сообщениями) — подменю и действия
- **Кнопка "Назад"** — возврат на один шаг назад в иерархии меню

### Основные функции

**WORKOUT:**
- Создайте недельный план тренировок (упражнения на каждый день)
- Отмечайте выполнение тренировок
- Получайте анализ нагрузки каждые 2 недели
- Треките сон и получайте графики каждое воскресенье

**SEARCH:**
- Введите запрос для поиска
- Получите до 3-5 видео с YouTube и статей

**ENG:**
- Изучайте неправильные глаголы, листая карточки
- Добавляйте слова для изучения или загружайте из CSV
- Учите слова по системе SRS с карточками

**ANALYTICS:**
- Просматривайте тепловую карту продуктивности (обновляется каждые 14 дней)
- Анализируйте статистику сессий фокуса

**FOCUS:**
- Добавляйте задачи для сессий фокуса
- Запускайте таймеры на выбранную задачу
- Записывайте мысли в "Разгрузку головы"

## Особенности

- **Минималистичный интерфейс** — без эмодзи, только текст и кнопки
- **Правильная навигация** — кнопка "Назад" всегда возвращает на один шаг назад
- **Без автоматических напоминаний** — бот не надоедает уведомлениями (кроме запланированных)
- **Короткие сообщения** — общение по делу, без лишнего текста
- **Без осуждения** — поддержка даже при неудачах
- **Локальное хранение** — все данные хранятся в SQLite
- **Push-уведомления** — автоматические напоминания о готовности тепловой карты и графика сна

## Разработка

Проект написан на Python с использованием:
- `aiogram 3` — асинхронный фреймворк для Telegram ботов
- `FastAPI` — веб-сервер для webhook
- `SQLite` — локальная база данных
- `matplotlib`, `seaborn`, `pandas` — генерация графиков и визуализаций
- `asyncio` — асинхронное программирование
- `google-api-python-client` — YouTube Data API
- `requests` — HTTP запросы для поиска статей

## Деплой

### Деплой на VPS (VDSina и другие)

1. Подключитесь к вашему VPS серверу по SSH
2. Установите Python 3.12 и необходимые системные зависимости:
   ```bash
   sudo apt update
   sudo apt install -y python3.12 python3.12-venv python3-pip
   sudo apt install -y libfreetype6-dev libpng-dev pkg-config libjpeg-dev zlib1g-dev
   sudo apt install -y libblas-dev liblapack-dev gfortran
   ```
3. Клонируйте репозиторий или загрузите файлы проекта
4. Создайте виртуальное окружение и установите зависимости:
   ```bash
   python3.12 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```
5. Создайте файл `.env` с переменными окружения:
   ```
   BOT_TOKEN=ваш_токен_бота
   WEBHOOK_URL=https://ваш-домен.com
   PORT=3000
   YOUTUBE_API_KEY=ваш_youtube_api_key
   TELEGRAM_USER_ID=ваш_telegram_user_id
   ```
6. Настройте systemd для автозапуска (создайте `/etc/systemd/system/bot.service`):
   ```ini
   [Unit]
   Description=Telegram Bot Напарник
   After=network.target

   [Service]
   Type=simple
   User=ваш_пользователь
   WorkingDirectory=/path/to/botFocus
   Environment="PATH=/path/to/botFocus/venv/bin"
   ExecStart=/path/to/botFocus/venv/bin/python bot.py
   Restart=always

   [Install]
   WantedBy=multi-user.target
   ```
7. Запустите сервис:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable bot
   sudo systemctl start bot
   ```
8. Настройте Nginx или другой reverse proxy для проксирования запросов на порт 3000

### Деплой на Render

Бот настроен для деплоя на Render.com:

1. Создайте новый Web Service на Render
2. Подключите GitHub репозиторий
3. Установите переменные окружения в Render Dashboard:
   - `BOT_TOKEN`
   - `RENDER_EXTERNAL_URL` (устанавливается автоматически)
   - `YOUTUBE_API_KEY` (опционально)
   - `TELEGRAM_USER_ID` (опционально)
4. Укажите Build Command: `pip install --upgrade pip setuptools wheel && pip install -r requirements.txt`
5. Укажите Start Command: `python bot.py`
6. Выберите Python 3.12 в настройках

## Лицензия

Проект создан для личного использования.

## Автор

Бот создан как напарник (hёlpik) в выстраивании личной эффективности.
